% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{report}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Data Support for Swedish Pharmacy Residents},
  pdfauthor={Jack B. Huber, Ph.D.},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{booktabs}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{Data Support for Swedish Pharmacy Residents}
\author{Jack B. Huber, Ph.D.}
\date{May 2022}

\begin{document}
\maketitle

\hypertarget{purpose-of-this-document}{%
\chapter{Purpose of this Document}\label{purpose-of-this-document}}

The purpose of this document is to assemble some advice and resources to
support Swedish Pharmacy residents in their journey from project
proposal to a completed research project.

\hypertarget{planning-your-project}{%
\chapter{Planning your Project}\label{planning-your-project}}

\hypertarget{the-causal-logic-of-your-project}{%
\section{The causal logic of your
project}\label{the-causal-logic-of-your-project}}

Fundamentally, the resident research project is an effort to gather
causal evidence for the claim that a particular treatment or way of
utilizing medicine ``worked'' by being more effective than a rival or
pre-existing treatment. To plan data collection for the strongest causal
evidence is the purpose of research design \citep{CampbellStanley1963}.

The ideal research design would be a pure experiment with random
assignment. The resident would randomly assign patients to treatment and
control conditions, then compare outcomes following treatment. In such a
scenario the resident could attribute any significant difference in
outcomes to the treatment because the groups would differ only by chance
in all other ways. Any pre-existing differences would be statistically
insignificant.

Because the resident cannot randomly assign patients to conditions going
forward, the project falls under the category of
\emph{\textbf{quasi-experiment}}. This means it is more vulnerable to
confounding explanations of any difference in outcomes.

The resident research project will culminate in a comparison between two
groups: a pre-implementation group and a post-implementation group. One
difference between the groups is time, and recent history has made a big
difference. Compare a pre-implementation group from the onset of the
pandemic with a high incidence of COVID-19 to a more recent
post-implementation group with much lower incidence of the virus. This
difference between the two groups in COVID-19 infection may combine with
the difference in drug dosing to influence treatment outcomes. This
difference in COVID-19 infection could therefore be a
\emph{\textbf{confound}}.

The point is to clarify:

\begin{itemize}
\tightlist
\item
  What is the outcome to improve? This is the dependent variable.
\item
  What is the difference in treatment intended to cause the improvement
  in the post-implementation group? This is the independent variable.
\item
  All other variables are control variables. They should differ only by
  chance. If there is a noticeable pre-existing difference, and the
  level of that factor in one group affects the outcome, it is a
  confound.
\end{itemize}

\hypertarget{how-many-patients}{%
\section{How many patients?}\label{how-many-patients}}

Possibly the most pressing question for resident research projects is:
How many patients do I need? The resident research project will
culiminate in a series of comparisons between the pre-implementation and
post-implementation groups. Outcomes of the two samples will differ by
at least some quantity. The resident researcher expresses this
difference as an effect, like this:

Assume that this effect suggests more favorable outcomes for the
post-implementation group. This effect raises several questions:

\begin{itemize}
\tightlist
\item
  How do we evaluate this effect?
\item
  Could we attribute it to chance? (because it would be very unlikely
  for both groups to have exactly the same outcomes)
\item
  Or is it larger than that?
\end{itemize}

In statistical terms, this is a question of \textbf{statistical power}.
Power is the ability to isolate a treatment effect when it really does
exist \citep{Cohen1988}. Power is a function of effect size, sample
size, and statistical significance. In order to decide on a number of
patients we need to have a sense of what size of effect we want to
reliably detect.

\begin{figure}
\centering
\includegraphics{index_files/figure-latex/power-1.pdf}
\caption{Power Analysis}
\end{figure}

This a plot of power rates against these other variables. A large effect
(r \textasciitilde{} 0.5) is detectable with a sample of any size. But
only large samples have the power to detect a statistically significant
(p \textless{} .05) small correlation (r = 0.1).

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{collecting-your-data}{%
\chapter{Collecting your Data}\label{collecting-your-data}}

\hypertarget{data-sources}{%
\section{Data Sources}\label{data-sources}}

For collecting data from Epic, it might be helpful to have a sense of
the landscape of its different databases. There are three primary
databases:

\includegraphics{EpicDataLandscape.png}

\textbf{Chronicles}. This is the database that is collecting data from
Hyperspace in real time. For reporting, Reporting Workbench pulls data
directly from Chronicles, but it is otherwise not designed very well for
historical reporting.

\textbf{Clarity}. This is the primary relational database for reporting
Epic data. Through a nightly process known as ETL
(``extract-transform-load''), Clarity extracts data from Chronicles and
stores it in a thousand bazillion tables (think ``spreadsheets''). To
pull data for a report from Clarity is to identify the correct tables
and fields and to write a SQL query to join the tables, apply the
appropriate selection criteria, and report the appropriate fields.

\textbf{Caboodle}. This a relatively new relational database that
functions essentially the same as Clarity but is designed to be much
easier to use. Caboodle uses fewer tables derived from myriad Clarity
tables which vastly simplifies the work and complexity of writing a SQL
query. The down side is not all Clarity data are in Caboodle.

\hypertarget{granularity-of-data}{%
\section{Granularity of data}\label{granularity-of-data}}

Granularity means two related things. One is the size of the data point
which is to say what context it provides for other, smaller, data
points. The other is, essentially this question: What does a row in the
spreadsheet mean? There are several different levels of granularity:

\textbf{Patient-level data}. A patient has a unique ID number: the MRN.
No two patients have the same MRN. When it comes to mining Epic data for
the research project, the patient list is perhaps the most important:
the resident needs a ``patient list''. When it comes to data mining, the
patient ``level'' is context to more granular data in the sense that a
patient can have multiple encounters - and thus multiple Encounter CSNs
``within'' the same Patient MRN.

\textbf{Encounter-level data}. The unique Epic ID number for the
encounter is the CSN. The encounter is context to more granular data
such as a treatment regimen of a particular medicine. Multiple drug
administrations can occur ``within'' an encounter CSN.

\textbf{Medication administration level data}. This is possibly the
lowest level and the most granular data. In Caboodle, each
administration of a medicine has a unique ID number and is time-stamped.
My queries to date have been for counts of medicine administrations, or
firsts, lasts, minimums and maximum doses within a hospital encounter or
ICU stay.

\textbf{Lab results level data}. Lab data is similar to medicine
administration data because, again in Caboodle, each lab result is has
its own unique ID number and is time-stamped. There can be a great many
lab results within a hospital encounter. My queries to date have been
for counts of lab results, or firsts, lasts, minimums and maximum values
within a hospital encounter or ICU stay.

The resident data collection form is designed for patient level data;
each row in the spreadsheet captures the experience of a hospital
encounter. It can also be helpful to report the medicine administration
and lab result data sorted chronologically by patient and encounter.

\hypertarget{advice-for-data-collection-and-management}{%
\section{Advice for Data Collection and
Management}\label{advice-for-data-collection-and-management}}

\textbf{Be proactive}. As you begin to decide what data to collect,
submit your project plan and requests for data in writing to me (Jack)
as soon as possible. This is so I can have a bit of time to understand
your project, do some discovery in Caboodle or Clarity, and note any
questions. Then meet with me via Teams to get on the same page.

\textbf{Devise a system for organizing your data}. By this I mean
version control. This data collection process is iterative. You will ask
for data and I'll write a SQL query that produces an Excel workbook of
data. That's one iteration. In all likelihood you'll need a revision or
two. Upon receiving your feedback I'll edit my query and produce for you
a new set of data to replace the first set. That's the second iteration.
The more iterations, the more data, the more potential for multiple
versions and data overload. And I may not be able to do more than a few
iterations. I can work on some best practices to help us through this.
Stay tuned.

\textbf{There is no substitute for chart review}. Some fraction of
resident research data can come from Epic data mining, but it still
needs to be validated with careful chart review. And some data which are
very difficult to mine or to query into the correct format may have to
come from chart review.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{analyzing-your-data}{%
\chapter{Analyzing your Data}\label{analyzing-your-data}}

You have data. Congratulations! Let's analyze!

\hypertarget{preparing-your-data-for-analysis}{%
\section{Preparing your data for
analysis}\label{preparing-your-data-for-analysis}}

The first step is to complete a number of tasks to prepare your data for
analysis. One data matrix. See the exemplar.

\hypertarget{choosing-appropriate-statistics}{%
\section{Choosing appropriate
statistics}\label{choosing-appropriate-statistics}}

It is important to know the measurement level of your variables. How do
you express the outcome by which to compare your pre- and post- samples?
Is it\ldots{}

\begin{itemize}
\tightlist
\item
  Mortality rate (\% surviving)? In such a case you would be comparing
  two proportions.
\item
  ``Time to\ldots{}'' a therapeutic level? In such a case you would be
  comparing two different quantities of time.
\end{itemize}

\hypertarget{odds-ratios}{%
\subsection{Odds ratios}\label{odds-ratios}}

\hypertarget{chi-square-test-of-independence}{%
\subsection{Chi-square test of
independence}\label{chi-square-test-of-independence}}

\hypertarget{two-sample-t-test}{%
\subsection{Two-sample t-test}\label{two-sample-t-test}}

\hypertarget{z-test-of-the-difference-of-proportions}{%
\subsection{Z test of the difference of
proportions}\label{z-test-of-the-difference-of-proportions}}

\hypertarget{cohens-d-effect-size}{%
\subsection{\texorpdfstring{Cohen's \emph{d} effect
size}{Cohen's d effect size}}\label{cohens-d-effect-size}}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\hypertarget{reporting-your-results}{%
\chapter{Reporting your Results}\label{reporting-your-results}}

\hypertarget{advice-on-graphs}{%
\section{Advice on graphs}\label{advice-on-graphs}}

\hypertarget{advice-on-tables}{%
\section{Advice on tables}\label{advice-on-tables}}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

  \bibliography{bibfile.bib,packages.bib}

\end{document}
